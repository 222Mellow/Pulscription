<div class="inner" *ngIf="(marketType$ | async) as marketType" waIntersectionObserver waIntersectionThreshold="0.5">
  <ng-container *ngIf="(activeMarketRouteData$ | async) as phunkData">

    <div class="header-wrapper">
      <h1 i18n>{{ marketTitles[marketType] }}</h1>
      <ng-container *ngIf="(route.queryParams | async)?.address as address">
        <h2 *ngIf="address">
          by
          <a [href]="env.explorerUrl + '/address/' + address" target="_blank">
            <app-wallet-address [address]="address" class="highlight"></app-wallet-address>
          </a>
        </h2>
      </ng-container>

      <h3>{{ phunkData.length | number }} Phunks Total</h3>
    </div>

    <div class="toolbar-wrapper">
      <div class="toolbar">
        <div class="left"></div>

        <div class="right">

          <div class="sort-wrapper">

            <div class="label">Sort:</div>
            <ng-select
              [(ngModel)]="activeSortModel"
              [items]="sorts"
              (change)="setSort($event)"
              [searchable]="false"
              [clearable]="false">
            </ng-select>
          </div>

          <button (click)="filtersVisible = !filtersVisible">Filter by Attribute</button>

          <div
            *ngIf="
              marketType === 'owned' &&
              (route.snapshot.queryParams.address | lowercase) === (walletAddress$ | async)
            "
            class="select-buttons">

            <button (click)="setSelectMiltiple()">Select</button>
            <button
              class="all-none"
              [class.all]="selectAll"
              *ngIf="selectMutipleActive"
              (click)="selectAll = !selectAll">

              all
            </button>
          </div>
        </div>
      </div>

      <div
        *ngIf="
          selectMutipleActive &&
          marketType === 'owned' &&
          (route.snapshot.queryParams.address | lowercase) === (walletAddress$ | async)
        "
        class="selection-toolbar">

        <div class="selected-label">
          Selected: {{ selectedHashIds.length }}
        </div>

        <div
          class="actions"
          [class.disabled]="!selectedHashIds.length">

          <button (click)="batchAction('list')">List</button>
          <button (click)="batchAction('transfer')">Transfer</button>
          <button (click)="batchAction('escrow')">Escrow</button>
          <button (click)="batchAction('withdraw')">Withdraw</button>
        </div>
      </div>
    </div>

    <div
      class="filter-wrapper"
      *ngIf="filtersVisible">

      <app-market-filters />
    </div>

    <app-phunk-grid
      [phunkData]="phunkData"
      [currentPage]="currentPage"
      [observe]="true"
      [selectable]="
        selectMutipleActive &&
        marketType === 'owned' &&
        (route.snapshot.queryParams.address | lowercase) === (walletAddress$ | async)
      "
      [(selected)]="selectedHashIds"
      [selectAll]="selectAll"
    />
  </ng-container>
</div>

<app-modal [class.active]="isListingBulk">
  <form [formGroup]="bulkListingForm">
    <div class="top-bar">
      <h2 i18n>Bulk List <span class="highlight">{{ bulkListingForm.value.listingPhunks?.length }}</span> Phunks</h2>
    </div>

    <div class="selected-wrapper">
      <ng-container formArrayName="listingPhunks">
        <div
          *ngFor="let phunk of selectedPhunksFormArray?.controls; let i = index"
          [formGroupName]="i">

          <div class="selected">
            <img
              [lazyLoad]="dataSvc.staticUrl + '/images/phunk' + (phunk.value.phunkId | tokenIdParse) + '.svg'"
              [defaultImage]="'assets/loadingphunk.png'"
              width="50"
              height="50"
            />

            <div class="form-item">
              <label [for]="phunk.value.phunkId">List Price</label>
              <input type="number" [id]="phunk.value.phunkId" placeholder="ETH" formControlName="listPrice">
            </div>
          </div>
        </div>
      </ng-container>
    </div>

    <div class="form-actions">
      <button type="reset" (click)="isListingBulk = false">Cancel</button>
      <button type="submit" (click)="submitBatchListing()">List All</button>
    </div>
  </form>
</app-modal>

<ng-template #prevIcon>
  <svg height="13" viewBox="0 0 8 13" width="8" xmlns="http://www.w3.org/2000/svg"><path d="m5.203125 10.40625v2.5664062h2.6015625v-2.5664062zm-2.6015625-2.6015625v2.6015625h2.6015625v-2.6015625zm-2.6015625-2.6015625v2.6015625h2.6015625v-2.6015625zm2.6015625-2.6015625v2.6015625h2.6015625v-2.6015625zm2.6015625-2.6015625v2.6015625h2.6015625v-2.6015625z" fill="rgba(var(--text-color), 1)"/></svg>
</ng-template>

<ng-template #nextIcon>
  <svg height="13" viewBox="0 0 8 13" width="8" xmlns="http://www.w3.org/2000/svg"><path d="m2.6015625 10.40625v2.5664062h-2.6015625v-2.5664062zm2.6015625-2.6015625v2.6015625h-2.6015625v-2.6015625zm2.6015625-2.6015625v2.6015625h-2.6015625v-2.6015625zm-2.6015625-2.6015625v2.6015625h-2.6015625v-2.6015625zm-2.6015625-2.6015625v2.6015625h-2.6015625v-2.6015625z" fill="rgba(var(--text-color), 1)"/></svg>
</ng-template>

<ng-template #thumbUpIcon>
  <svg height="16" viewBox="0 0 15 16" width="15" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><g fill="#ffca00"><path d="m5 0h1v4h-1z"/><path d="m11 13h1v1h-1z"/><path d="m11 10h2v1h-2z"/><path d="m11 7h2v1h-2z"/><path d="m10 8h1v2h-1z"/><path d="m13 6h1v1h-1z"/><path d="m14 8h1v2h-1z"/><path d="m13 11h1v2h-1z"/><path d="m12 5h1v1h-1z"/><path d="m10 11h1v2h-1z"/><path d="m10 14h1v1h-1z"/></g><path d="m6 0h1v6h-1z" fill="#ffe73e"/><path d="m5 4h1v10h-1z" fill="#ffe73e"/><path d="m4 6h1v8h-1z" fill="#ffe73e"/><path d="m0 9h2v4h-2z" fill="#ffe73e"/><path d="m10 5h2v2h-2z" fill="#ffe73e"/><path d="m11 8h3v2h-3z" fill="#ffe73e"/><path d="m11 11h2v2h-2z" fill="#ffe73e"/><path d="m11 14h1v1h-1z" fill="#ffe73e"/><path d="m12 6h1v1h-1z" fill="#ffe73e"/><path d="m3 7h1v6h-1z" fill="#ffe73e"/><path d="m7 1h1v4h-1z" fill="#ffe73e"/><path d="m4 4h1v2h-1z" fill="#ffca00"/><path d="m3 6h1v1h-1z" fill="#ffca00"/><path d="m0 8h2v1h-2z" fill="#ffca00"/><path d="m0 13h2v1h-2z" fill="#ffca00"/><path d="m3 13h1v1h-1z" fill="#ffca00"/><path d="m4 14h2v1h-2z" fill="#ffca00"/><path d="m6 14h2v1h-2z" fill="#ffca00"/><path d="m6 6h1v8h-1z" fill="#ffca00"/><path d="m2 9h1v4h-1z" fill="#ffca00"/><path d="m7 5h1v1h-1z" fill="#ffca00"/><path d="m0 7h3v1h-3z" fill="#ff9e00"/><path d="m8 5h2v1h-2z" fill="#ff9e00"/><path d="m9 6h1v1h-1z" fill="#ff9e00"/><path d="m9 14h1v1h-1z" fill="#ff9e00"/><path d="m9 11h1v2h-1z" fill="#ff9e00"/><path d="m9 8h1v2h-1z" fill="#ff9e00"/><path d="m10 7h1v1h-1z" fill="#ff9e00"/><path d="m10 10h1v1h-1z" fill="#ff9e00"/><path d="m10 13h1v1h-1z" fill="#ff9e00"/><path d="m0 14h3v1h-3z" fill="#d76525"/><path d="m3 15h9v1h-9z" fill="#d76525"/><path d="m8 6h1v9h-1z" fill="#d76525"/><path d="m9 7h1v1h-1z" fill="#d76525"/><path d="m9 10h1v1h-1z" fill="#d76525"/><path d="m9 13h1v1h-1z" fill="#d76525"/><path d="m2 8h1v1h-1z" fill="#ff9e00"/><path d="m13 7h1v1h-1z" fill="#ff9e00"/><path d="m13 10h1v1h-1z" fill="#ff9e00"/><path d="m12 13h1v2h-1z" fill="#ff9e00"/><path d="m7 6h1v8h-1z" fill="#ff9e00"/><path d="m2 13h1v1h-1z" fill="#ff9e00"/><path d="m3 14h1v1h-1z" fill="#ff9e00"/></g></svg>
</ng-template>
